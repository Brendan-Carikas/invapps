{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { prefix } from '../constants';\nimport { Log } from './log';\n/**\n * 对数据进行打标，加上 level\n */\nexport var setFlowTag = function (data, limitLevel) {\n  if (limitLevel === void 0) {\n    limitLevel = 100;\n  }\n  var resNodes = [];\n  var _a = data.nodes,\n    nodes = _a === void 0 ? [] : _a,\n    _b = data.edges,\n    edges = _b === void 0 ? [] : _b;\n  var levelNodes = [];\n  var getTarget = function (source) {\n    return edges.filter(function (item) {\n      var _a;\n      var used = resNodes.findIndex(function (t) {\n        return t.id === item.target;\n      });\n      if (used !== -1 && item.source === source) {\n        var loop = getSource(item.source);\n        Log.warn(\"The data [\".concat(item.source, \",\").concat(item.target, \",\").concat((_a = loop[0]) === null || _a === void 0 ? void 0 : _a.source, \"] is in a loop, please check the rationality.\"));\n      }\n      return used === -1 && item.source === source;\n    });\n  };\n  var getSource = function (target) {\n    return edges.filter(function (item) {\n      return item.target === target;\n    });\n  };\n  edges.forEach(function (item) {\n    var source = item.source;\n    if (!edges.find(function (item) {\n      return item.target === source;\n    })) levelNodes.push(source);\n  });\n  var level = 0;\n  var appendInfo = function (item) {\n    var _a;\n    return _a = {}, _a[\"\".concat(prefix, \"_level\")] = level, _a[\"\".concat(prefix, \"_parent\")] = getSource(item.id).map(function (n) {\n      return n.source;\n    }), _a[\"\".concat(prefix, \"_children\")] = level < limitLevel - 1 ? getTarget(item.id).map(function (n) {\n      return n.target;\n    }) : [], _a;\n  };\n  if (!levelNodes.length) {\n    return {\n      edges: edges,\n      nodes: nodes.map(function (item) {\n        return __assign(__assign({}, item), appendInfo(item));\n      })\n    };\n  }\n  var _loop_1 = function () {\n    var currentLevelNodes = nodes.filter(function (item) {\n      return levelNodes.includes(item.id);\n    });\n    resNodes = resNodes.concat(currentLevelNodes.map(function (item) {\n      return __assign(__assign({}, item), appendInfo(item));\n    }));\n    var nextLevelNodes = [];\n    levelNodes.forEach(function (source) {\n      nextLevelNodes.push.apply(nextLevelNodes, getTarget(source).map(function (item) {\n        return item.target;\n      }));\n    });\n    levelNodes = nextLevelNodes;\n    level += 1;\n  };\n  while (levelNodes.length) {\n    _loop_1();\n  }\n  return {\n    nodes: resNodes,\n    edges: edges\n  };\n};","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","prefix","Log","setFlowTag","data","limitLevel","resNodes","_a","nodes","_b","edges","levelNodes","getTarget","source","filter","item","used","findIndex","id","target","loop","getSource","warn","concat","forEach","find","push","level","appendInfo","map","_loop_1","currentLevelNodes","includes","nextLevelNodes"],"sources":["/Users/invotradesign/CascadeProjects/site-users-app/node_modules/@ant-design/graphs/es/utils/set-flow-tag.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { prefix } from '../constants';\nimport { Log } from './log';\n/**\n * 对数据进行打标，加上 level\n */\nexport var setFlowTag = function (data, limitLevel) {\n    if (limitLevel === void 0) { limitLevel = 100; }\n    var resNodes = [];\n    var _a = data.nodes, nodes = _a === void 0 ? [] : _a, _b = data.edges, edges = _b === void 0 ? [] : _b;\n    var levelNodes = [];\n    var getTarget = function (source) {\n        return edges.filter(function (item) {\n            var _a;\n            var used = resNodes.findIndex(function (t) { return t.id === item.target; });\n            if (used !== -1 && item.source === source) {\n                var loop = getSource(item.source);\n                Log.warn(\"The data [\".concat(item.source, \",\").concat(item.target, \",\").concat((_a = loop[0]) === null || _a === void 0 ? void 0 : _a.source, \"] is in a loop, please check the rationality.\"));\n            }\n            return used === -1 && item.source === source;\n        });\n    };\n    var getSource = function (target) {\n        return edges.filter(function (item) { return item.target === target; });\n    };\n    edges.forEach(function (item) {\n        var source = item.source;\n        if (!edges.find(function (item) { return item.target === source; }))\n            levelNodes.push(source);\n    });\n    var level = 0;\n    var appendInfo = function (item) {\n        var _a;\n        return (_a = {},\n            _a[\"\".concat(prefix, \"_level\")] = level,\n            _a[\"\".concat(prefix, \"_parent\")] = getSource(item.id).map(function (n) { return n.source; }),\n            _a[\"\".concat(prefix, \"_children\")] = level < limitLevel - 1 ? getTarget(item.id).map(function (n) { return n.target; }) : [],\n            _a);\n    };\n    if (!levelNodes.length) {\n        return {\n            edges: edges,\n            nodes: nodes.map(function (item) { return (__assign(__assign({}, item), appendInfo(item))); }),\n        };\n    }\n    var _loop_1 = function () {\n        var currentLevelNodes = nodes.filter(function (item) { return levelNodes.includes(item.id); });\n        resNodes = resNodes.concat(currentLevelNodes.map(function (item) { return (__assign(__assign({}, item), appendInfo(item))); }));\n        var nextLevelNodes = [];\n        levelNodes.forEach(function (source) {\n            nextLevelNodes.push.apply(nextLevelNodes, getTarget(source).map(function (item) { return item.target; }));\n        });\n        levelNodes = nextLevelNodes;\n        level += 1;\n    };\n    while (levelNodes.length) {\n        _loop_1();\n    }\n    return { nodes: resNodes, edges: edges };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}